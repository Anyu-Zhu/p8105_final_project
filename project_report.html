<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Analysis of Consumer Behavior in the Time of Covid-19</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exploratory Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="covid_state_case_rate.html">Covid-19 in the US</a>
    </li>
    <li>
      <a href="consumption_timely_trend.html">Consumption Expenditure</a>
    </li>
  </ul>
</li>
<li>
  <a href="linear_model.html">Regression Analysis</a>
</li>
<li>
  <a href="https://bshiny.shinyapps.io/interactive_maps/">Regional Data</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="project_report.html">Project Report</a>
</li>
<li>
  <a href="https://www.youtube.com/">
    <span class="fa fa-youtube"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/sz3029/final_project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Analysis of Consumer Behavior in the Time of Covid-19</h1>

</div>


<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>Ever since the spring of 2020, the COVID-19 pandemic has drastically altered the everyday lives of billions of people. Besides the way of living and working, the pandemic is slowly changing our way of consumption.</p>
<center>
<img src="images/covid_people_image.jpg" style="width:60%" class="center"> <br>Image source: <a href="https://www.google.com/imghp?hl=en&amp;ogbl">Google</a>
</center>
<p>As people were working from home and went out less due to restrictions on gatherings and social activities, we infer there might be a collapse in consumption mainly in the services sector, while consumption in indoor entertainment, household supplies etc. may increase as a result of the more time at home. We can get a brief sense of how our behaviors of consumption is changing from the changes in Engel Coefficient ever since the pandemic started.</p>
<center>
<img src="images/engel.png" style="width:60%" class="center">
</center>
<p>To further explore the changes of consumer behaviors caused by the pandemic, our group studied joint data collected from Bureau of Economic Analysis, and Center for Disease Control and Prevention.</p>
<p> </p>
</div>
<div id="related-work" class="section level2">
<h2>Related Work</h2>
<p>1.”The decline and recovery of consumer spending in the US” Brookings, December 14, 2020 <a href="https://www.brookings.edu/blog/future-development/2020/12/14/the-decline-and-recovery-of-consumer-spending-in-the-us/">link</a><br />
</p>
<p>2.”A spring in consumers’ steps: Americans prepare to get back to their spending ways”Deloitte, June 28, 2021 <a href="https://www2.deloitte.com/us/en/insights/economy/us-consumer-spending-after-covid.html">link</a></p>
<p> </p>
</div>
<div id="research-design" class="section level2">
<h2>Research Design</h2>
<div id="initial-question" class="section level3">
<h3>Initial Question</h3>
<p>Our project is designed to investigate how the Covid-19 pandemic has affected US people’s consuming behavior. We intend to research whether there are changes to people’s total personal consumption expenditure(PCE) and their consumption pattern since the pandemic happened in March 2020. We are also interested in how much people’s consuming behaviors has recovered since the society is gradually returning to normal life in 2021.</p>
<p>Initial Hypothesis: Covid 19 changes the value/structure of consumption expenditure.</p>
</div>
<div id="evolution-of-analytic-questions" class="section level3">
<h3>Evolution of Analytic Questions</h3>
<p>• There is evidence that the severity of Covid-19 varies among states, so as the PCE. To address the differences, we analyzed the data by states by drawing maps based on Covid 19 and consumption expenditure data.</p>
<p>• The pandemic has lasted for two years, thus using the data since the pandemic for modeling is insufficient and biased. To address this problem, we build a prediction model of PCE based on income and consumption data since 1967. To test the hypothesis, we predict the consumption data in 2020 and 2021 using the model and compare it to the real-world data.</p>
<p>• The inflation and recent rises in prices potentially affect the PCE data as well. To address this, we considered inflation and analyze using chained dollars. which is a method of adjusting real dollar amounts for inflation over time, allowing the comparison of figures from different years.</p>
</div>
<div id="new-questions-identified-during-analysis" class="section level3">
<h3>New Questions Identified During Analysis</h3>
<p>PCE is also affected by the trend of personal incomes, and government’s laws to support and sustain businesses and individuals through the pandemic. In addition, we examined how the pandemic has impacted personal incomes and savings in U.S., and whether they matched the changing of PCE. In this process, we can obtain more comprehensive understanding of how the pandemic has influenced people’s economic conditions and behaviors in different aspects.</p>
<p> </p>
</div>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<div id="data-sources" class="section level3">
<h3>Data Sources</h3>
<p>
<p>• Personal Consumption Expenditures by Major Type of Product and by Major Function:</p>
<p><a href="https://www.bea.gov/data/consumer-spending/main" class="uri">https://www.bea.gov/data/consumer-spending/main</a></p>
<p>
<p>• Personal Consumption Expenditures by Major Type of Product and by Major Function, by State:</p>
<p><a href="https://apps.bea.gov/itable/iTable.cfm?ReqID=70&amp;step=1" class="uri">https://apps.bea.gov/itable/iTable.cfm?ReqID=70&amp;step=1</a></p>
<p>
<p>• Trends in Number of COVID-19 Cases and Deaths in the US Reported to CDC:</p>
<p><a href="https://covid.cdc.gov/covid-data-tracker/#trends_dailycases" class="uri">https://covid.cdc.gov/covid-data-tracker/#trends_dailycases</a></p>
</div>
<div id="variables-of-interest" class="section level3">
<h3>Variables of Interest</h3>
<strong>Consumption Expenditure</strong>
<p>
• <code>functions</code>: the different functions of the goods.
<p>
• <code>time</code>: different quarters.
<p>
<p>• <code>consumption</code>: the total amount of consumptions.</p>
<strong>COVID Cumulative Cases</strong>
<p>
• <code>state</code>
<p>
• <code>date</code>: the date when the data collected.
<p>
• <code>total_cases</code>: the amount to the cases diagnosed within and before the date.
<p>
<p>• <code>case_rate</code>: the amount of cases since the pandemic started for every 100,000 people.</p>
<strong>COVID Daily Cases</strong>
<p>
• <code>state</code>
<p>
• <code>date</code>: the date when the data collected.
<p>
<p>• <code>total_cases</code>: the amount to the cases diagnosed within the date.</p>
<strong>PCE by State</strong>
<p>
• <code>state</code>
<p>
• <code>year</code>: the year of which the PCE by date was calculated.
<p>
<p>• <code>type</code>: major types of product.</p>
<strong>Personal Income and Savings</strong>
<p>
• <code>wages_and_salaries</code>: wages and salaries received from employers
<p>
• <code>supplements_to_wages_and_salaries</code>: supplemental payments received from employers
<p>
• <code>social_security</code>: benefits include old-age, survivors, and disability insurance benefits that are distributed from the federal old-age and survivors insurance trust fund and the disability insurance trust fund
<p>
• <code>medicare</code>: benefits include hospital and supplementary medical insurance benefits that are distributed from the federal hospital insurance trust fund and the supplementary medical insurance trust fund
<p>
<p>• <code>personal_current_taxes</code>: total personal tax payment</p>
</div>
<div id="data-cleaning" class="section level3">
<h3>Data cleaning</h3>
<P>
<p>From <code>Consumption Function</code>, we deleted unneeded rows (whose row numbers are greater than 28, since these rows are not showing the function of the goods), made a <code>time</code> variable that sorted the years and the quarter. We renamed <code>Household consumption expenditures (for services)</code> to <code>household</code>, and renamed <code>Final consumption expenditures of nonprofit institutions serving households (NPISHs)1</code> to <code>nonprofit consumption</code>, since the original names are too long.</p>
<P>
<p>From <code>COVID Cumulative Cases</code>, we combined the new case data frame and the cumulative case data frame together and seperate the time points into <code>month</code>, <code>day</code> and <code>year</code>. Then we created a new variable named <code>date</code> that rewrite the date into the form of <code>YYYY-MM-DD</code>.</p>
<P>
<p>To compare the covid case data and the consumption data, we built a new data frame named <code>covid_seasonal</code> that reorder the covid case data by season (quarter 1 = January - March, quarter 2 = April - June, quarter 3 = July - September, quarter 4 = October - December).</p>
<P>
<p>From <code>PCE by State</code>, we renamed some variables,deleted some unneeded columns and use <code>pivot_longer</code> to tidy the dataframe. We added a <code>code</code> variable for each state, in convenience of making interactive maps. Then we joined the total and per capita dataframe, calculated the percent change of PCE each year using <code>lag</code> function.</p>
<p> </p>
</div>
</div>
<div id="exploratory-data-analysis" class="section level2">
<h2>Exploratory Data Analysis</h2>
<p>
<p>The lowest value of consumption expenditure actually did not happen as expected at the peak of the pandemic but at the second quarter of 2020, when cases just start to rise. The expenditures of services experienced a steeper change than expenditures of goods due to the shutdown of businesses, the quarantine and the lock down policies etc.Even though cases keep rising, as restrictions keep lifting, the rate of vaccination keep rising, economics keep recovering, people’s consumption expenditure grows steadly after the third quarter of 2020. Although the severity of Covid 19 reached to the first peak in the fourth quarter of 2020, it has limited effect on people’s consumption behavior. The total consumption expenditure is even larger by now comparing with that before the pandemic. This can be partially explained by inflation and government’s stimulus plan.</p>
<center>
<img src="images/eda_1.png" style="width:60%" class="center">
</center>
<div id="us-covid-19" class="section level3">
<h3>US Covid 19</h3>
<p>
<p>The dataset of Covid 19 in the United States begins from January 17, 2020. With cumulative number of postive cases keep rising, the first peak of new cases occurred in the summer of 2020, and the largest peak happened at the beginning of 2021.</p>
<center>
<img src="images/covid.png" style="width:60%" class="center">
</center>
<p>If analyze based on states, California, Texas, and Floida has the greatest number of total positive cases. However, considering the population factor, states in central part of the US tend to have higher case rate (positive number of cases per 100k people), with North Dakota being the one with the highest rate.</p>
</div>
<div id="consumption-expenditure" class="section level3">
<h3>Consumption Expenditure</h3>
<p>
<p>Durable goods are divided into four categories. Consumption in <code>Recreational goods and vehicles</code> and <code>furnishings and durable household equipment</code> did not experience significant drop in the second quarter of 2020 like the other two. Changes in working mode and more time spent at home resulted in people’s growing demand for household equipment and in-door recreational equipments.</p>
<p>Nondurable goods are divided into four categories. The proportion of consumption expenditure on food/beverages and other nondurable goods exceeds much than that of clothing/footware and energy goods all time. Even when Covid outbroke, unlike the changes in consumption of clothing/footware and energy goods, that in food/beverages and other nondurable goods is not experiencing reduction in the pandemic but increases steadly.</p>
<div class="figure" style="text-align: center">
<img src="images/eda_2.png" alt="PCE by function" width="50%" height="50%" /><img src="images/eda_3.png" alt="PCE by function" width="50%" height="50%" />
<p class="caption">
PCE by function
</p>
</div>
<p>Expenditures in household services are divided into seven categories. Only the <code>housing and utilities</code>(which mainly includes housing rental and the fees for the resources at home such as electricity and gas) and <code>financial service and insurance</code> (which mainly includes life and health insurance and commissions in banks) were not reduced but even increased in the pandemic. Expenditures of outdoor services like <code>Transportation</code>, <code>Food service and accomodation</code>, and <code>Recreation service</code> reduced significantly in the second quarter of 2020 due to nationwide quarantine policies. The total consumption of transportation and recreation services hasn’t recovered to the level before the pandemic by the third quarter of 2021.</p>
<center>
<img src="images/eda_4.png" style="width:60%" class="center">
</center>
<p> </p>
<div id="pce-by-state" class="section level4">
<h4>PCE by State</h4>
<p>State personal consumption expenditures (PCE) decreased 2.6 percent in 2020 after increasing 3.7 percent in 2019, according to statistics released today by the U.S. Bureau of Economic Analysis (BEA). The percent change in PCE across all 50 states and the District of Columbia ranged from 1.2 percent in Idaho and Utah to –5.8 percent in the District of Columbia. PCE increased in only four states, Idaho, Utah, Montana, and Arkansas.</p>
<pre class="r"><code>library(tidyverse)
library(readxl)
library(plotly)

#load data for pce by states
raw_df = 
  read_excel(&quot;data/pce_by_state/pce_by_state.xlsx&quot;, sheet = &quot;Table 1&quot;, range = &quot;A4:F63&quot;, col_names = FALSE)

colnames(raw_df) = c(&quot;state&quot;, &quot;pce_2018&quot;, &quot;pce_2019&quot;, &quot;pce_2020&quot;, &quot;change_2019&quot;, &quot;change_2020&quot;)

postal_code = 
  read_csv(&quot;./data/us_postal_code.csv&quot;) %&gt;% 
  janitor::clean_names()

pce_state_df_1 = 
  raw_df %&gt;% 
  filter(!(state %in% c(&quot;United States&quot;, &quot;New England&quot;, &quot;Mideast&quot;, &quot;Great Lakes&quot;, &quot;Plains&quot;, &quot;Southeast&quot;, &quot;Southwest&quot;, &quot;Rocky Mountain&quot;, &quot;Far West&quot;))) %&gt;% 
  mutate(
    text_2020 = paste(state, &quot;\n&quot;, &quot;PCE:&quot;, pce_2020),
    text_2019 = paste(state, &quot;\n&quot;, &quot;PCE:&quot;, pce_2019),
    text_change_2020 = paste(state, &quot;\n&quot;, &quot;Percent change:&quot;, change_2020),
    text_change_2019 = paste(state, &quot;\n&quot;, &quot;Percent change:&quot;, change_2019)
  )

pce_state_df_1 = left_join(pce_state_df_1, postal_code, by = &quot;state&quot;)

personal_df = 
  read_excel(&quot;data/pce_by_state/pce_by_state.xlsx&quot;, sheet = &quot;Table 4&quot;, range = &quot;A4:G63&quot;, col_names = FALSE)

colnames(personal_df) = c(&quot;state&quot;, &quot;personal_pce_2020&quot;, &quot;housing&quot;, &quot;health&quot;, &quot;food&quot;, &quot;gasoline&quot;, &quot;other&quot;)

pce_state_df_1 = 
  left_join(pce_state_df_1, personal_df, by = &quot;state&quot;) %&gt;% 
  mutate(
    population = pce_2020 / personal_pce_2020,
    personal_pce_2019 = round(pce_2019 / population),
    text_personal_2020 = paste(state, &quot;\n&quot;, &quot;Personal PCE:&quot;, personal_pce_2020),
    text_personal_2019 = paste(state, &quot;\n&quot;, &quot;Personal PCE:&quot;, personal_pce_2019)
  )

# load data set of covid by states
read_data_function = function(file_df) {
  
  state_df = 
    read_csv(file_df, skip = 2)
  
  return(state_df)
}
# create a data frame containing all participants
state_2020 =
  tibble(
    files = list.files(&quot;./data/state_covid_separate&quot;)
  ) %&gt;% 
  mutate(
    path = map(.x = files, ~paste(&quot;./data/state_covid_separate&quot;, ., sep = &quot;/&quot;))
  ) %&gt;%                                                             # add path
  mutate(
    observations = map(path, read_data_function))

state_2020_tidy =
  state_2020 %&gt;% 
  unnest(cols = &quot;observations&quot;) %&gt;% 
  janitor::clean_names() %&gt;% 
  filter(date == &quot;Dec 31 2020&quot;) %&gt;%
  select(state, total_cases, total_case_rate_per_100k)

covid_state_df = left_join(state_2020_tidy, postal_code, by = &quot;state&quot;) %&gt;%
  drop_na()

#plotly percent change
g = list(
  scope = &#39;usa&#39;,
  projection = list(type = &#39;albers usa&#39;)
)

fig_1 = 
  plot_geo(pce_state_df_1, locationmode = &#39;USA-states&#39;) %&gt;% 
  add_trace(
    type = &quot;scattergeo&quot;,
    locations = ~code,
    text = ~code,
    mode = &quot;text&quot;,
    textfont = list(color = rgb(0,0,0), size = 10),
    hoverinfo = &quot;none&quot;
  ) %&gt;% 
  add_trace(
    z = ~change_2020, 
    locations = ~code,
    text = ~text_change_2020,
    color = ~change_2020, 
    colorscale = list(c(0, 0.85, 1), c(&quot;#c44934&quot;, &quot;#ffffff&quot;, &quot;#83c5fd&quot;)),
    hoverinfo = &quot;text&quot;,
    colorbar = list(title = &quot;PCE growth rates(%)&quot;, thickness = 20, x = 1, y = 0.8),
    visible = T
  ) %&gt;% 
  add_trace(
    z = ~change_2019, 
    locations = ~code,
    text = ~text_change_2019,
    color = ~change_2019, 
    colorscale = list(c(0, 1), c(&quot;#f5faff&quot;, &quot;#0863b0&quot;)),
    hoverinfo = &quot;text&quot;,
    colorbar = list(title = &quot;PCE growth rates(%)&quot;, thickness = 20, x = 1, y = 0.8),
    visible = F
  ) %&gt;%
  layout(
    title = &#39;Personal Consumption Expenditures by State: Percent Change&#39;,
    geo = g,
    updatemenus = list(
      list(
        type = &#39;buttons&#39;,
        x = 0.1,
        y = 0.95,
        buttons = list(
          list(method = &quot;restyle&quot;,
               args = list(&quot;visible&quot;, list(T, T, F)),
               label = &#39;2019-2020&#39;),
          
          list(method = &quot;restyle&quot;,
               args = list(&quot;visible&quot;, list(T, F, T)),
               label = &#39;2018-2019&#39;)
        )))
  )

fig_1</code></pre>
<div id="htmlwidget-83ca882ac7b5b9d3db29" style="width:864px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-83ca882ac7b5b9d3db29">{"x":{"visdat":{"d5f7a13b6f3":["function () ","plotlyVisDat"]},"cur_data":"d5f7a13b6f3","attrs":{"d5f7a13b6f3":{"locationmode":"USA-states","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattergeo","locations":{},"text":{},"mode":"text","textfont":{"color":"#000000","size":10},"hoverinfo":"none","inherit":true},"d5f7a13b6f3.1":{"locationmode":"USA-states","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"z":{},"locations":{},"text":{},"color":{},"colorscale":[[0,0.85,1],["#c44934","#ffffff","#83c5fd"]],"hoverinfo":"text","colorbar":{"title":"PCE growth rates(%)","thickness":20,"x":1,"y":0.8},"visible":true,"inherit":true},"d5f7a13b6f3.2":{"locationmode":"USA-states","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"z":{},"locations":{},"text":{},"color":{},"colorscale":[[0,1],["#f5faff","#0863b0"]],"hoverinfo":"text","colorbar":{"title":"PCE growth rates(%)","thickness":20,"x":1,"y":0.8},"visible":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"mapType":"geo","title":"Personal Consumption Expenditures by State: Percent Change","geo":{"domain":{"x":[0,1],"y":[0,1]},"scope":"usa","projection":{"type":"albers usa"}},"updatemenus":[{"type":"buttons","x":0.1,"y":0.95,"buttons":[{"method":"restyle","args":["visible",[true,true,false]],"label":"2019-2020"},{"method":"restyle","args":["visible",[true,false,true]],"label":"2018-2019"}]}],"scene":{"zaxis":{"title":"change_2020"}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.333333333333333}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"locationmode":"USA-states","type":"scattergeo","locations":["CT","ME","MA","NH","RI","VT","DE","DC","MD","NJ","NY","PA","IL","IN","MI","OH","WI","IA","KS","MN","MO","NE","ND","SD","AL","AR","FL","GA","KY","LA","MS","NC","SC","TN","VA","WV","AZ","NM","OK","TX","CO","ID","MT","UT","WY","AK","CA","HI","NV","OR","WA"],"text":["CT","ME","MA","NH","RI","VT","DE","DC","MD","NJ","NY","PA","IL","IN","MI","OH","WI","IA","KS","MN","MO","NE","ND","SD","AL","AR","FL","GA","KY","LA","MS","NC","SC","TN","VA","WV","AZ","NM","OK","TX","CO","ID","MT","UT","WY","AK","CA","HI","NV","OR","WA"],"mode":"text","textfont":{"color":"#000000","size":10},"hoverinfo":["none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none"],"marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"line":{"color":"rgba(31,119,180,1)"},"geo":"geo","frame":null},{"colorbar":{"title":"PCE growth rates(%)","ticklen":2,"thickness":20,"x":1,"y":0.8,"len":0.333333333333333,"lenmode":"fraction","yanchor":"top"},"colorscale":[[0,"#c44934"],[0.85,"#ffffff"],[1,"#83c5fd"]],"showscale":true,"locationmode":"USA-states","z":[-3.2,-1.6,-5.1,-1.8,-3.8,-3.9,-2.2,-5.8,-4.4,-2.7,-5.3,-4,-3.6,-1.1,-2.9,-2.1,-2.3,-2.4,-1.4,-4.3,-2.4,-1.2,-3.5,-0.7,-0.7,0.1,-2,-1.9,-0.9,-1.7,-0.6,-0.5,-0.3,-1,-2.7,-2.5,-0.2,-2.3,-1.1,-0.8,-0.9,1.2,0.4,1.2,-1.5,-5.7,-4.4,-5.3,-2.3,-1.3,-2.4],"locations":["CT","ME","MA","NH","RI","VT","DE","DC","MD","NJ","NY","PA","IL","IN","MI","OH","WI","IA","KS","MN","MO","NE","ND","SD","AL","AR","FL","GA","KY","LA","MS","NC","SC","TN","VA","WV","AZ","NM","OK","TX","CO","ID","MT","UT","WY","AK","CA","HI","NV","OR","WA"],"text":["Connecticut <br /> Percent change: -3.2","Maine <br /> Percent change: -1.6","Massachusetts <br /> Percent change: -5.1","New Hampshire <br /> Percent change: -1.8","Rhode Island <br /> Percent change: -3.8","Vermont <br /> Percent change: -3.9","Delaware <br /> Percent change: -2.2","District of Columbia <br /> Percent change: -5.8","Maryland <br /> Percent change: -4.4","New Jersey <br /> Percent change: -2.7","New York <br /> Percent change: -5.3","Pennsylvania <br /> Percent change: -4","Illinois <br /> Percent change: -3.6","Indiana <br /> Percent change: -1.1","Michigan <br /> Percent change: -2.9","Ohio <br /> Percent change: -2.1","Wisconsin <br /> Percent change: -2.3","Iowa <br /> Percent change: -2.4","Kansas <br /> Percent change: -1.4","Minnesota <br /> Percent change: -4.3","Missouri <br /> Percent change: -2.4","Nebraska <br /> Percent change: -1.2","North Dakota <br /> Percent change: -3.5","South Dakota <br /> Percent change: -0.7","Alabama <br /> Percent change: -0.7","Arkansas <br /> Percent change: 0.1","Florida <br /> Percent change: -2","Georgia <br /> Percent change: -1.9","Kentucky <br /> Percent change: -0.9","Louisiana <br /> Percent change: -1.7","Mississippi <br /> Percent change: -0.6","North Carolina <br /> Percent change: -0.5","South Carolina <br /> Percent change: -0.3","Tennessee <br /> Percent change: -1","Virginia <br /> Percent change: -2.7","West Virginia <br /> Percent change: -2.5","Arizona <br /> Percent change: -0.2","New Mexico <br /> Percent change: -2.3","Oklahoma <br /> Percent change: -1.1","Texas <br /> Percent change: -0.8","Colorado <br /> Percent change: -0.9","Idaho <br /> Percent change: 1.2","Montana <br /> Percent change: 0.4","Utah <br /> Percent change: 1.2","Wyoming <br /> Percent change: -1.5","Alaska <br /> Percent change: -5.7","California <br /> Percent change: -4.4","Hawaii <br /> Percent change: -5.3","Nevada <br /> Percent change: -2.3","Oregon <br /> Percent change: -1.3","Washington <br /> Percent change: -2.4"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"visible":true,"type":"choropleth","marker":{"line":{"colorbar":{"title":"","ticklen":2},"cmin":-5.8,"cmax":5.4,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[-3.2,-1.6,-5.1,-1.8,-3.8,-3.9,-2.2,-5.8,-4.4,-2.7,-5.3,-4,-3.6,-1.1,-2.9,-2.1,-2.3,-2.4,-1.4,-4.3,-2.4,-1.2,-3.5,-0.7,-0.7,0.1,-2,-1.9,-0.9,-1.7,-0.6,-0.5,-0.3,-1,-2.7,-2.5,-0.2,-2.3,-1.1,-0.8,-0.9,1.2,0.4,1.2,-1.5,-5.7,-4.4,-5.3,-2.3,-1.3,-2.4]}},"geo":"geo","frame":null},{"colorbar":{"title":"PCE growth rates(%)","ticklen":2,"thickness":20,"x":1,"y":0.8,"len":0.333333333333333,"lenmode":"fraction","yanchor":"top"},"colorscale":[[0,"#f5faff"],[1,"#0863b0"]],"showscale":true,"locationmode":"USA-states","z":[2.1,3.4,3.5,3.6,2.8,2.5,3.6,3.5,2.5,3.4,3.9,3.1,2.6,2.5,2.8,2.7,2.8,2.1,3,2.9,3,2.6,2.1,3.8,4,2.7,4.3,4,2.7,3,1.8,5,4.3,4.1,2.9,2.3,5.2,2,2.2,4,5.2,4.3,3.5,5.4,2,3.1,4.7,3.9,4.8,4.5,4.5],"locations":["CT","ME","MA","NH","RI","VT","DE","DC","MD","NJ","NY","PA","IL","IN","MI","OH","WI","IA","KS","MN","MO","NE","ND","SD","AL","AR","FL","GA","KY","LA","MS","NC","SC","TN","VA","WV","AZ","NM","OK","TX","CO","ID","MT","UT","WY","AK","CA","HI","NV","OR","WA"],"text":["Connecticut <br /> Percent change: 2.1","Maine <br /> Percent change: 3.4","Massachusetts <br /> Percent change: 3.5","New Hampshire <br /> Percent change: 3.6","Rhode Island <br /> Percent change: 2.8","Vermont <br /> Percent change: 2.5","Delaware <br /> Percent change: 3.6","District of Columbia <br /> Percent change: 3.5","Maryland <br /> Percent change: 2.5","New Jersey <br /> Percent change: 3.4","New York <br /> Percent change: 3.9","Pennsylvania <br /> Percent change: 3.1","Illinois <br /> Percent change: 2.6","Indiana <br /> Percent change: 2.5","Michigan <br /> Percent change: 2.8","Ohio <br /> Percent change: 2.7","Wisconsin <br /> Percent change: 2.8","Iowa <br /> Percent change: 2.1","Kansas <br /> Percent change: 3","Minnesota <br /> Percent change: 2.9","Missouri <br /> Percent change: 3","Nebraska <br /> Percent change: 2.6","North Dakota <br /> Percent change: 2.1","South Dakota <br /> Percent change: 3.8","Alabama <br /> Percent change: 4","Arkansas <br /> Percent change: 2.7","Florida <br /> Percent change: 4.3","Georgia <br /> Percent change: 4","Kentucky <br /> Percent change: 2.7","Louisiana <br /> Percent change: 3","Mississippi <br /> Percent change: 1.8","North Carolina <br /> Percent change: 5","South Carolina <br /> Percent change: 4.3","Tennessee <br /> Percent change: 4.1","Virginia <br /> Percent change: 2.9","West Virginia <br /> Percent change: 2.3","Arizona <br /> Percent change: 5.2","New Mexico <br /> Percent change: 2","Oklahoma <br /> Percent change: 2.2","Texas <br /> Percent change: 4","Colorado <br /> Percent change: 5.2","Idaho <br /> Percent change: 4.3","Montana <br /> Percent change: 3.5","Utah <br /> Percent change: 5.4","Wyoming <br /> Percent change: 2","Alaska <br /> Percent change: 3.1","California <br /> Percent change: 4.7","Hawaii <br /> Percent change: 3.9","Nevada <br /> Percent change: 4.8","Oregon <br /> Percent change: 4.5","Washington <br /> Percent change: 4.5"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"visible":false,"type":"choropleth","marker":{"line":{"colorbar":{"title":"","ticklen":2},"cmin":-5.8,"cmax":5.4,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[2.1,3.4,3.5,3.6,2.8,2.5,3.6,3.5,2.5,3.4,3.9,3.1,2.6,2.5,2.8,2.7,2.8,2.1,3,2.9,3,2.6,2.1,3.8,4,2.7,4.3,4,2.7,3,1.8,5,4.3,4.1,2.9,2.3,5.2,2,2.2,4,5.2,4.3,3.5,5.4,2,3.1,4.7,3.9,4.8,4.5,4.5]}},"geo":"geo","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Generally, there is an apparent negative correlation between per capita PCE and Covid rates.</p>
<pre class="r"><code># create joint data frame
jointly_df = 
  left_join(pce_state_df_1, covid_state_df, by = c(&quot;state&quot;, &quot;code&quot;)) %&gt;% 
  mutate(state = as.factor(state)) %&gt;% 
  select(state, code, pce_2020, total_case_rate_per_100k, everything())

# make plot
Con_case_by_state =
jointly_df %&gt;% 
  arrange(total_case_rate_per_100k) %&gt;% 
  mutate(state = fct_reorder(state, total_case_rate_per_100k)) %&gt;% 
  plot_ly(x = ~state) %&gt;% 
  add_trace(y = ~personal_pce_2020, type = &quot;scatter&quot;, mode = &quot;lines&quot;,name = &quot;PCE&quot;, yaixs = &quot;y&quot;) %&gt;% 
  add_trace(y = ~total_case_rate_per_100k, type = &quot;bar&quot;, name = &quot;Covid Cases(per 100k)&quot;, yaxis = &quot;y2&quot;, opacity = 0.6, marker = list(color = &#39;rgb(158,202,225)&#39;))  %&gt;% 
  layout(title = list(text = &quot;Per Capita PCE with Covid Cases, 2020&quot;, x = 0.13),
         xaxis = list(title = &quot;State&quot;),
         yaxis = list(title = &quot;PCE&quot;, side = &quot;left&quot;),
         yaxis2 = list(title = &quot;Covid Rate&quot;, side = &quot;right&quot;, overlaying = &quot;y&quot;),
         showlegend = TRUE)

Con_case_by_state</code></pre>
<div id="htmlwidget-782b27c42c50d1585733" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-782b27c42c50d1585733">{"x":{"visdat":{"d5f133310ce":["function () ","plotlyVisDat"]},"cur_data":"d5f133310ce","attrs":{"d5f133310ce":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"scatter","mode":"lines","name":"PCE","yaixs":"y","inherit":true},"d5f133310ce.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"Covid Cases(per 100k)","yaxis":"y2","opacity":0.6,"marker":{"color":"rgb(158,202,225)"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":"Per Capita PCE with Covid Cases, 2020","x":0.13},"xaxis":{"domain":[0,1],"automargin":true,"title":"State","type":"category","categoryorder":"array","categoryarray":["Vermont","Hawaii","Maine","Oregon","Washington","New Hampshire","District of Columbia","Virginia","Maryland","West Virginia","New York","Pennsylvania","Connecticut","Massachusetts","North Carolina","California","Michigan","New Jersey","Ohio","Colorado","Delaware","Texas","Florida","South Carolina","Kentucky","Alaska","Georgia","Louisiana","New Mexico","Arizona","Nevada","Missouri","Minnesota","Alabama","Mississippi","Arkansas","Indiana","Illinois","Montana","Kansas","Wyoming","Idaho","Oklahoma","Tennessee","Rhode Island","Utah","Nebraska","Iowa","Wisconsin","South Dakota","North Dakota"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"PCE","side":"left"},"yaxis2":{"title":"Covid Rate","side":"right","overlaying":"y"},"showlegend":true,"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["Vermont","Hawaii","Maine","Oregon","Washington","New Hampshire","District of Columbia","Virginia","Maryland","West Virginia","New York","Pennsylvania","Connecticut","Massachusetts","North Carolina","California","Michigan","New Jersey","Ohio","Colorado","Delaware","Texas","Florida","South Carolina","Kentucky","Alaska","Georgia","Louisiana","New Mexico","Arizona","Nevada","Missouri","Minnesota","Alabama","Mississippi","Arkansas","Indiana","Illinois","Montana","Kansas","Wyoming","Idaho","Oklahoma","Tennessee","Rhode Island","Utah","Nebraska","Iowa","Wisconsin","South Dakota","North Dakota"],"y":[47397,45080,45272,42055,46041,51760,65169,42757,44331,37206,49735,44650,50437,52001,38295,46636,41274,50221,39866,46642,45434,39661,43615,37554,36574,48739,38165,37354,35264,38684,39211,39999,44403,35859,32358,34479,38097,43981,42310,38845,42016,35459,34533,37499,42944,37369,41142,37586,40963,41825,43945],"type":"scatter","mode":"lines","name":"PCE","yaixs":"y","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Vermont","Hawaii","Maine","Oregon","Washington","New Hampshire","District of Columbia","Virginia","Maryland","West Virginia","New York","Pennsylvania","Connecticut","Massachusetts","North Carolina","California","Michigan","New Jersey","Ohio","Colorado","Delaware","Texas","Florida","South Carolina","Kentucky","Alaska","Georgia","Louisiana","New Mexico","Arizona","Nevada","Missouri","Minnesota","Alabama","Mississippi","Arkansas","Indiana","Illinois","Montana","Kansas","Wyoming","Idaho","Oklahoma","Tennessee","Rhode Island","Utah","Nebraska","Iowa","Wisconsin","South Dakota","North Dakota"],"y":[1116.4,1485,1800.4,2700.7,3235.9,3238,4106.7,4156.4,4635,4761.6,4958.5,5066.2,5208.8,5443.3,5467.3,5647.8,5905,5942,5991.7,6029.1,6043.3,6056.6,6138,6164.3,6181.7,6256.8,6277,6781.9,6813.3,7151.8,7296.1,7325,7364,7389.5,7456.9,7460.3,7600.7,7602.6,7630.7,7635.1,7673.1,7894.3,8226.6,8441.8,8448.2,8628.1,8645.2,8895.8,8938.5,11209.3,12173.6],"type":"bar","name":"Covid Cases(per 100k)","yaxis":"y2","opacity":0.6,"marker":{"color":"rgb(158,202,225)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="regression-analysis" class="section level2">
<h2>Regression Analysis</h2>
<p>
<p>Using the personal consumption expenditure (PCE) and income data, we aimed to investigate how the COVID-19 pandemic influence people’s spending patterns. We know that one’s consumption is associate with one’s income, so we built a MLR model from income data and made predictions for PCE. Our variables of interest include <code>wages and salaries</code>, <code>supplements to wages and salaries</code>, <code>social security</code>, <code>medicare</code>, <code>personal current taxes</code>, and the outcome <code>PCE</code>.</p>
<p>
<p>We hypothesized that the PCE pattern has changed with respect to income for pre- v.s. in-pandemic periods. To test this hypothesis, we fitted a MLR model using data from year 1967-2018, the “pre-pandemic” period. We then used this model to predict for PCE outcomes for a pre-pandemic year, 2019, and a in-pandemic year, 2020, respectively. Then we compared if there is significant difference in the root mean square errors (RMSE) between the pre-pandemic and in-pandemic periods. If there is significant difference between them, we can conclude that there is enough evidence showing that the PCE patterns has changed during the pandemic and vice versa.</p>
<p>
<p>Our model fits the data well because our <span class="math inline">\(R^2\)</span> value is <span class="math inline">\(&gt; 99\%\)</span>. We then used multiple diagnostic methods to evaluate the model. The QQ-plot indicates the distribution of residuals are normal. The Scale-location plot shows that the residuals are spread equally along the range of predictors. And the residuals-leverage plot shows that no outlier is influential. Therefore, we were confident to proceed our analysis with the MLR model.</p>
<p>
<p>Giving the MLR model and its predictions for PCE, we explored the difference in the root mean square errors (RMSE) of the model between the pre-pandemic and in-pandemic periods in dollars. To obtain a pool of RMSE data, we utilized bootstrapping method on data of year 2019 and 2020. The results were tested via the t-test, which indicated a significant difference between the RMSEs of the two years. This indicated that people’s spending pattern has changed during the pandemic, and this change could not fully explain by variations of their incomes.</p>
<p>
<p>Therefore, there is evidence showing that the COVID-19 pandemic has affected people’s spending patterns.</p>
<p> </p>
</div>
<div id="discussion" class="section level2">
<h2>Discussion</h2>
<p>First, we performed a series of exploratory analyses on COVID-19 cases and expenditure data. We visualized the cases of COVID-19 in the U.S. from 2020 up to now. The bar plot reveals that the first peak of the positive cases in the U.S. occurred in April 2020, and it kept rising in the entire pandemic period. We then visualized the case number per state on a map plot, from which we found that California has the greatest number of positive cases, whereas North Dakota has the largest case rate. Our observation showed that some central states also have a relatively large case rate compared to other states.</p>
<p>To understand the consumption expenditure components, we then looked at the goods and services consumed at the beginning of and during the pandemic (from the year 2019 to 2021). We observed that the percentages of both durable and nondurable goods dropped significantly in the second quarter of 2020, but it bounced back to normal level afterward. It revealed a temporary influence of pandemic on consumption expenditure, although which effect seemed to dampen over several months.</p>
<p>Afterward, to verify our hypothesis that the COVID-19 did affect the spending pattern, we proposed a model based on population income to predict the personal consumption expenditure (PCE). The model is built using pre-pandemic data since 1967 and tested on the year 2019 and 2020 to illustrate the difference in the predictions. We then performed statistical tests via bootstrapping samples and conclude that there is a significant difference between our model prediction of PCE for the year 2019 and the year 2020. This indicated that people’s spending patterns have changed during the pandemic, which cannot be fully explained by variations in their incomes. Therefore, there is evidence showing that the COVID-19 pandemic has affected people’s spending patterns.</p>
<p>Then we used <code>shiny</code> to analyze the PCE patterns by state and year. From the map we found that the cases per state were inversely proportional to the per state expenditure i.e., people tended to spend less among states where the pandemic was more severe. Overall, we concluded that the COVID-19 pandemic has a negative impact on people’s expenditure patterns in the U.S.</p>
<div id="limitations" class="section level3">
<h3>Limitations</h3>
<p>There are some limitations in our study: the personal consumption expenditure (PCE) data retrieved from BEA is on a quarterly basis, so we only have less than 30 observations after the covid outbreak. Thus, the dataset is not sufficient to model the consumption expenditure in the pandemic period. To address this problem, we built a regression model of consumption expenditure based on personal savings data from 1967 and test the significance of the changes between the predicted value in 2020 and the actual value. What’s more, since the data is given quarterly, some abnormal changes might be impossible to observe. As for PCE by state, we could only achieve data until 2020, so the analysis of reconciliation and prediction is limited.</p>
</div>
<div id="future-implication" class="section level3">
<h3>Future Implication</h3>
Based on analysis of consumption structure, we observed that the consumer behaviors are gradually returning to the level before the COVID. Even though life is getting back to normal, the new variant Omicron is now coming, and several related cases have been confirmed in the United States. The future is hard to predict, we are still uncertain what is waiting for us in the coming new year. There might be another significant wave of changes economic changes due to the new outbreak. Thus, the changing pattern we analyzed can be used as reference for residents and businesses to get better prepared for future changes.
<center>
<img src="images/omicron.jpg" style="width:60%" class="center"> <br>Image source: <a href="https://www.google.com/imghp?hl=en&amp;ogbl">Google</a>
</center>
<p> </p>
</div>
</div>
<div id="conclusions" class="section level2">
<h2>Conclusions</h2>
<p>Consumer spending is the key component of quarterly gross domestic product. Spending data for the nation and each state help businesses predict consumer behavior and make decisions about hiring and investing. These statistics also help policymakers and researchers understand the interplay between Americans’ incomes, spending, and saving. The expenditure pattern is presumably affected by domestic income, and other social or environmental factors. Our study explored the influence of the pandemic on expenditure to understand how public health factor affects spending behaviors.</p>
<p>Overall, the findings for the changes in consumption expenditure during the pandemic is consistent with what we had originally hypothesized. We expected there was changes in the value as well as the structure of the consumption of goods and services due to covid pandemic. More specifically, we found that consumption expenditures of services experienced a steeper change than expenditures of goods due to the shutdown of businesses, the quarantine, and the lock down policies etc.The regression model we built for consumption prediction demonstrated the significant difference of PEC for year 2019 and 2020 and confirmed the hypothesis that covid pandemic had affected people’s spending pattern.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
